<html>
<head>
    <meta charset="utf-8">    
    <link rel="stylesheet" type="text/css" href="semantic/dist/semantic.min.css">
    <style>
html{
    height: 100%;
}
body {
    position:absolute; top:0; bottom:0; right:0; left:0;
}
#output svg {
    width: 100%;
    height: 100%;
}
main{
    height: calc(100% - 4em);
    width: 100%
}
.toprightattached
{
    position: absolute;
    top     : -15px;
    right   : -15px
}
    </style>
</head>
<body>
    <nav class="ui menu inverted">
        <div class="header item">Родословная</div>
        <a class="active item"><i class="eye icon"></i>Просмотр</a>
        <a id="ch_person" class="item"><i class="user icon"></i>Изменение персоналий</a>
        <a class="item"><i class="users icon"></i>Изменение семей</a>
        <a class="item"><i class="sitemap icon"></i>Изменение связей</a>
    </nav>
    <div class="ui active dimmer">
        <div class="ui loader"></div>
    </div>
    <main class="ui container" id="output">
        
    </main>
    <script src="static/jquery-2.2.0.min.js"></script>
    <script src="static/semantic.min.js"></script>
    <script src="static/viz.js"></script>
    <script src="static/live.js"></script>
    <script src="static/svg-pan-zoom.js"></script>
    <script>
function create(ins){
    s = Viz(ins).replace(
        "<svg",
        '<svg id="output-svg" preserveAspectRatio="xMinYMin meet" class="ui image fluid" '
        );
    $("#output").append(s);
    svgPanZoom("#output-svg");
    $("#output-svg")
        .attr("width","100%")
        .attr("height", "100%")
        .contextmenu(function(){return false;});
}
function add_with_animaion(sel, sing, plur, value){
    $(sel).append("<p>&nbsp;</p>"); 
    var data = $(
        '<div class="ui input">'+
        ' <input placeholder="'+sing+'" type="text">'+
        ' <button class="ui toprightattached circular mini negative icon button">'+
        ' <i class="icon minus"></i>'+
        '</button>').hide(); 
    $(sel).append(data); data.slideDown(); 
    $(sel+" div button.ui.negative")
       .off("click")
       .click(del_click_handler(sing,plur))    
    l = $(sel).find("div").length
    if (l==1){
        $(sel).find("h3")
      .text(sing)
    }else{
        $(sel).find("h3")
          .text(plur)
    }
    if(value){
        data.find("input").attr("value", value);
    }
}
function del_click_handler(sing,plur){
return  function(){
    pp = $(this).parent().parent()
    l = pp.find("div").length
    if (l==2){
        pp.find("h3")
      .text(sing)
    }else{
        pp.find("h3")
          .text(plur)
    }
    $(this).parent()
        .slideUp(400, function(){
            a = $(this)
            a.prev().remove()
            a[0].remove();
        })
}
}
function multifield_input(sel, cls, hsingular, hplural, arr=[]){
    var ndiv = $(
        '<div class="segment '+cls+'">'+
        ' <h3>'+((arr.length>1) ? hplural : hsingular)+'</h3>'+
        ' <div class="ui input">'+
        '  <input type="text" placeholder="'+hsingular+'" value="">'+
        '  <button class="ui toprightattached circular mini positive icon button">'+
        '   <i class="icon plus"></i>'+
        '  </button>'+
        '</div>')
    ndiv.find("button").click(function(){
            add_with_animaion(sel+" .segment."+cls, hsingular, hplural)
        });
    if(arr.length>1){
        ndiv.find("input").attr("value", arr[0]);
    }
    $(sel).append(ndiv)
    for (i=1;i<arr.length;i++){
        add_with_animaion(sel+" .segment."+cls, hsingular, hplural, arr[i]);
    }
}
function fio_inputs(sel, fams=[], nams=[], snams=[]){
    $(sel).append('<div class="ui three column middle aligned grid fio"></div>')
    multifield_input(sel+" .fio", "fam", "Фамилия", "Фамилии", fams);
    multifield_input(sel+" .fio", "nam", "Имя", "Имена", nams);
    multifield_input(sel+" .fio", "snam", "Отчество", "Отчества", snams);
}
function edit(sel, pers){
    if(pers){
        idd = pers.id;
    }else{
        idd = -1;
        pers = {
            families: [],
            names: [],
            snames: []
        }
    }
    var ndiv = $(
      '<div id="pers'+idd+'" class="ui modal">'+
      '    <i class="close icon"></i>'+
      '    <div class="icon header"><i class="edit icon"></i>Изменить человека</div>'+
      '    <div class="content"></div>'+
      '    <div class="actions">'+
      '        <div class="two fluid ui inverted buttons">'+
      '            <div class="ui red deny button"><i class="remove icon"></i>Отменить</div>'+
      '            <div class="ui green positive right button"><i class="checkmark icon"></i>Сохранить</div>'+
      '        </div>'+
      '    </div>'+
      '</div>'
    )
    ndiv.find(".actions div .ui.button").click(function(){
        ndiv.remove()
    });
    $(sel).append(ndiv);
    fio_inputs("#pers"+idd+" .content", pers.families, pers.names, pers.snames);
    return ndiv
}
$(document).ready(function() {
    //('main').height($('body').height() - $('.ui.menu').height())
    $('.ui.menu a.item').on('click', function() {
        $(this)
            .addClass('active')
            .siblings()
            .removeClass('active');
          });
    //create($("#graphsrc").text());
    $("#ch_person").on('click', function(){
        edit("main", 
             {families:["Иванов", "Петров"], 
              names:["Иван", "Павел"],
              snames:["Иванович", "Павлович"],
              id:1
             }).modal('show');
    });
    $(".ui.active.dimmer").removeClass("active").remove()
    //fio_inputs("main",["Иванов", "Иван"]);
});
    </script>
</body>
</html>
